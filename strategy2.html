<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>策略模式</title>

    <script src="./blockly_uncompressed_vertical.js"></script>
    <script src="./msg/messages.js"></script>
    <script src="./blocks_strategy/vertical_extensions.js"></script>
    <script src="./generator_strategy/javascript.js"></script>
    <script src="./generator_strategy/class.js"></script>
    <script src="./blocks_common/math.js"></script>
    <script src="./blocks_common/text.js"></script>
    <script src="./blocks_common/colour.js"></script>
    <script src="./blocks_strategy/class.js"></script>
    <script src="./blocks_strategy/method.js"></script>
    <script src="./blocks_strategy/attribute.js"></script>
    <script src="./blocks_strategy/strategy_toolbox2.js"></script>

    <script>
        'use strict';

        var workspace = null;

        function start() {
            var soundsEnabled = null;
            if (sessionStorage) {
                // Restore sounds state.
                soundsEnabled = sessionStorage.getItem('soundsEnabled');
                if (soundsEnabled === null) {
                    soundsEnabled = true;
                } else {
                    soundsEnabled = (soundsEnabled === 'true');
                }
            } else {
                soundsEnabled = true;
            }

            // Setup blocks
            // Parse the URL arguments.
            var match = location.search.match(/dir=([^&]+)/);
            var rtl = match && match[1] == 'rtl';
            var toolbox = getToolboxElement();

            match = location.search.match(/side=([^&]+)/);

            var side = match ? match[1] : 'start';

            // Create main workspace.
            workspace = Blockly.inject('blocklyDiv', {
                comments: false,
                disable: false,
                collapse: false,
                media: '../media/',
                readOnly: false,
                rtl: rtl,
                scrollbars: true,
                toolbox: toolbox,
                toolboxPosition: side == 'top' || side == 'start' ? 'start' : 'end',
                horizontalLayout: side == 'top' || side == 'bottom',
                sounds: soundsEnabled,
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 0.75,
                    maxScale: 4,
                    minScale: 0.25,
                    scaleSpeed: 1.1
                },
                colours: {
                    fieldShadow: 'rgba(255, 255, 255, 0.3)',
                    dragShadowOpacity: 0.6
                }
            });

            if (sessionStorage) {
                // Restore event logging state.
                var state = sessionStorage.getItem('logEvents');
                logEvents(Boolean(state));

                // Restore flyout event logging state.
                state = sessionStorage.getItem('logFlyoutEvents');
                logFlyoutEvents(Boolean(state));
            }
        }

        function getToolboxElement() {
            var match = location.search.match(/toolbox=([^&]+)/);
            return document.getElementById('toolbox-' + (match ? match[1] : 'categories'));
        }

        function logEvents(state) {
            if (sessionStorage) {
                sessionStorage.setItem('logEvents', state ? 'checked' : '');
            }
            if (state) {
                workspace.addChangeListener(logger);
            } else {
                workspace.removeChangeListener(logger);
            }
        }

        function logFlyoutEvents(state) {
            if (sessionStorage) {
                sessionStorage.setItem('logFlyoutEvents', state ? 'checked' : '');
            }
            var flyoutWorkspace = (workspace.flyout_) ? workspace.flyout_.workspace_ :
                workspace.toolbox_.flyout_.workspace_;
            if (state) {
                flyoutWorkspace.addChangeListener(logger);
            } else {
                flyoutWorkspace.removeChangeListener(logger);
            }
        }

        function logger(e) {
            console.log(e);
        }

        function runCode() {
            alert(Blockly['JavaScript'].workspaceToCode(workspace));
        }

    </script>

    <style>
        html, body {
            height: 100%;
        }

        body {
            background-color: #fff;
            font-family: sans-serif;
            overflow: hidden;
        }

        h1 {
            font-weight: normal;
            font-size: 140%;
        }

        #blocklyDiv {
            float: left;
            height: 95%;
            width: 70%;
        }

        #collaborators {
            float: right;
            width: 30px;
            margin-left: 10px;
        }

        #collaborators > img {
            margin-right: 5px;
            height: 30px;
            padding-bottom: 5px;
            width: 30px;
            border-radius: 3px;
        }

        .blocklyFlyout {
            background: #666;
        }

        .description {
            float: left;
            width: 25%;
            margin-left: 2.5%;
        }

        .description div {
            margin: 20px 0;
        }
    </style>
</head>
<body onload="start()">

    <div id="collaborators"></div>
    <div id="blocklyDiv"></div>
    <!-- Simple toolbox -->
    <xml id="toolbox-simple" style="display: none">
        <block type="operator_random">
            <value name="FROM">
                <shadow type="math_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="TO">
                <shadow type="math_number">
                    <field name="NUM">10</field>
                </shadow>
            </value>
        </block>
        <block type="operator_lt">
            <value name="OPERAND1">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
            <value name="OPERAND2">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
        </block>
        <block type="operator_equals">
            <value name="OPERAND1">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
            <value name="OPERAND2">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
        </block>
        <block type="operator_gt">
            <value name="OPERAND1">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
            <value name="OPERAND2">
                <shadow type="text">
                    <field name="TEXT"></field>
                </shadow>
            </value>
        </block>
        <block type="operator_and"></block>
        <block type="operator_or"></block>
        <block type="operator_not"></block>
        <block type="operator_join">
            <value name="STRING1">
                <shadow type="text">
                    <field name="TEXT">hello</field>
                </shadow>
            </value>
            <value name="STRING2">
                <shadow type="text">
                    <field name="TEXT">world</field>
                </shadow>
            </value>
        </block>
        <block type="operator_letter_of">
            <value name="LETTER">
                <shadow type="math_whole_number">
                    <field name="NUM">1</field>
                </shadow>
            </value>
            <value name="STRING">
                <shadow type="text">
                    <field name="TEXT">world</field>
                </shadow>
            </value>
        </block>
        <block type="operator_length">
            <value name="STRING">
                <shadow type="text">
                    <field name="TEXT">world</field>
                </shadow>
            </value>
        </block>
        <block type="operator_mod">
            <value name="NUM1">
                <shadow type="math_number">
                    <field name="NUM"></field>
                </shadow>
            </value>
            <value name="NUM2">
                <shadow type="math_number">
                    <field name="NUM"></field>
                </shadow>
            </value>
        </block>
        <block type="operator_round">
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM"></field>
                </shadow>
            </value>
        </block>
        <block type="operator_mathop">
            <value name="OPERATOR">
                <shadow type="operator_mathop_menu"></shadow>
            </value>
            <value name="NUM">
                <shadow type="math_number">
                    <field name="NUM"></field>
                </shadow>
            </value>
        </block>
    </xml>

    <div class="description">
        <div>在本场景中，类属性即是前一场景中具体类的实例，通过改变实例的类，就能方便地切换方法的实现</div>
        <div>请给“动物”类加上适当的属性和方法</div>
        <input type="button" value="Run Code" onclick="runCode()">
        <input type="button" value="下一场景" onclick="window.location.href='./strategy2.html'">
    </div>

</body>
</html>